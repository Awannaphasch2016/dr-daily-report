"""
Tests for ReasoningQualityScorer
"""

import pytest
from src.reasoning_quality_scorer import ReasoningQualityScorer, ReasoningQualityScore


class TestReasoningQualityScorer:
    """Test suite for ReasoningQualityScorer"""
    
    def setup_method(self):
        """Set up test fixtures"""
        self.scorer = ReasoningQualityScorer()
        
        # Sample indicators
        self.indicators = {
            'rsi': 65.36,
            'macd': 2.5,
            'uncertainty_score': 52.0,
            'atr': 0.70,
            'current_price': 53.93,
            'vwap': 44.20,
            'volume': 1000000,
            'volume_sma': 1150000
        }
        
        # Sample percentiles
        self.percentiles = {
            'rsi': {
                'current_value': 65.36,
                'percentile': 88.5
            },
            'uncertainty_score': {
                'current_value': 52.0,
                'percentile': 66.0
            }
        }
        
        # Sample ticker data
        self.ticker_data = {
            'company_name': 'Apple Inc.',
            'ticker': 'AAPL',
            'current_price': 53.93
        }
    
    def test_clarity_good(self):
        """Test clarity scoring with good explanations"""
        narrative = """
        üìñ ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
        Uncertainty score 52/100 ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏•‡∏≤‡∏î‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏™‡∏π‡∏á ‡∏ã‡∏∂‡πà‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤
        ‡∏ï‡∏•‡∏≤‡∏î‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß
        
        üí° ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ
        RSI 65.36 ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡πÑ‡∏ó‡∏•‡πå 88.5% ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ RSI ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥
        ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏ã‡∏∂‡πà‡∏á‡∏ö‡πà‡∏á‡∏ä‡∏µ‡πâ‡∏ß‡πà‡∏≤ stock ‡∏≠‡∏≤‡∏à‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏†‡∏≤‡∏ß‡∏∞ overbought
        
        üéØ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ?
        ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ BUY ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ uncertainty score ‡∏ï‡πà‡∏≥‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡πÅ‡∏£‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å
        
        ‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏≠‡∏∞‡πÑ‡∏£?
        ‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
        """
        
        score = self.scorer.score_narrative(
            narrative, self.indicators, self.percentiles, self.ticker_data
        )
        
        assert score.dimension_scores['clarity'] >= 80
        assert any('Clear cause-effect' in strength for strength in score.strengths)
    
    def test_coverage_full(self):
        """Test coverage scoring with full coverage"""
        narrative = """
        üìñ ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
        Uncertainty score 52/100 ‡∏ã‡∏∂‡πà‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏•‡∏≤‡∏î‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏™‡∏π‡∏á
        
        üí° ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ
        Technical analysis: RSI 65.36, MACD 2.5
        Volatility: Uncertainty score 52/100 ‡πÅ‡∏•‡∏∞ ATR 1.30%
        Market sentiment: VWAP ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏£‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å
        Volume: Volume ratio 0.87x
        Fundamental: P/E ratio 28.5
        Historical: RSI ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡πÑ‡∏ó‡∏•‡πå 88.5%
        
        üéØ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ?
        ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ BUY
        
        ‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏≠‡∏∞‡πÑ‡∏£?
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á...
        """
        
        score = self.scorer.score_narrative(
            narrative, self.indicators, self.percentiles, self.ticker_data
        )
        
        assert score.dimension_scores['coverage'] >= 80
    
    def test_specificity_good(self):
        """Test specificity scoring with specific details"""
        narrative = """
        üìñ ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
        Uncertainty score 52/100 ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡πÑ‡∏ó‡∏•‡πå 66%
        ATR 1.30% ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏ï‡πà‡∏≥
        ‡∏£‡∏≤‡∏Ñ‡∏≤ 22.06% ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ VWAP
        Volume ratio 0.87x ‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢
        
        üí° ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ
        RSI 65.36 ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡πÑ‡∏ó‡∏•‡πå 88.5% - ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÉ‡∏ô‡∏≠‡∏î‡∏µ‡∏ï
        
        üéØ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ?
        ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ BUY
        
        ‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏≠‡∏∞‡πÑ‡∏£?
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á...
        """
        
        score = self.scorer.score_narrative(
            narrative, self.indicators, self.percentiles, self.ticker_data
        )
        
        assert score.dimension_scores['specificity'] >= 80
        assert any('specific numbers' in strength.lower() for strength in score.strengths)
    
    def test_alignment_good(self):
        """Test alignment scoring with aligned explanations"""
        narrative = """
        üìñ ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
        Uncertainty score 52/100 ‡∏ã‡∏∂‡πà‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏•‡∏≤‡∏î‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏™‡∏π‡∏á  # Correct: 50-75 is "high"
        ATR 1.30% ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏ï‡πà‡∏≥  # Correct: <2.0 is "low"
        ‡∏£‡∏≤‡∏Ñ‡∏≤ 22.06% ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ VWAP ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏£‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å  # Correct: >15 is "strong_buy"
        
        üí° ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ
        Technical indicators...
        
        üéØ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ?
        ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ BUY
        
        ‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏≠‡∏∞‡πÑ‡∏£?
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á...
        """
        
        score = self.scorer.score_narrative(
            narrative, self.indicators, self.percentiles, self.ticker_data
        )
        
        assert score.dimension_scores['alignment'] >= 80
    
    def test_minimality_good(self):
        """Test minimality scoring with concise but complete reasoning"""
        narrative = """
        üìñ ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
        Uncertainty score 52/100 ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏•‡∏≤‡∏î‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏™‡∏π‡∏á
        
        üí° ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ
        RSI 65.36 ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡πÑ‡∏ó‡∏•‡πå 88.5% ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏ß‡∏∞ overbought
        
        üéØ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ?
        ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ BUY ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ uncertainty ‡∏ï‡πà‡∏≥‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡πÅ‡∏£‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å
        
        ‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏≠‡∏∞‡πÑ‡∏£?
        ‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô
        """
        
        score = self.scorer.score_narrative(
            narrative, self.indicators, self.percentiles, self.ticker_data
        )
        
        assert score.dimension_scores['minimality'] >= 80
    
    def test_consistency_good(self):
        """Test consistency scoring with consistent explanations"""
        narrative = """
        üìñ ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
        Uncertainty score 52/100 ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏•‡∏≤‡∏î‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏™‡∏π‡∏á
        
        üí° ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ
        RSI 65.36 ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡πÑ‡∏ó‡∏•‡πå 88.5%
        
        üéØ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ?
        ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ BUY
        
        ‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏≠‡∏∞‡πÑ‡∏£?
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á...
        """
        
        score = self.scorer.score_narrative(
            narrative, self.indicators, self.percentiles, self.ticker_data
        )
        
        assert score.dimension_scores['consistency'] >= 80
    
    def test_consistency_conflicting_recommendations(self):
        """Test consistency scoring with conflicting recommendations"""
        narrative = """
        üìñ ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
        Uncertainty score 52/100
        
        üí° ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ
        Technical indicators...
        
        üéØ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ?
        ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ BUY ‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏£ SELL ‡πÄ‡∏û‡∏£‡∏≤‡∏∞...
        
        ‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏≠‡∏∞‡πÑ‡∏£?
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á...
        """
        
        score = self.scorer.score_narrative(
            narrative, self.indicators, self.percentiles, self.ticker_data
        )
        
        assert score.dimension_scores['consistency'] < 80
        assert any('conflicting' in issue.lower() for issue in score.issues)
    
    def test_overall_score_calculation(self):
        """Test overall score calculation"""
        narrative = """
        üìñ ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
        Uncertainty score 52/100 ‡∏ã‡∏∂‡πà‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏•‡∏≤‡∏î‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏™‡∏π‡∏á
        
        üí° ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ
        RSI 65.36 ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡πÑ‡∏ó‡∏•‡πå 88.5%
        
        üéØ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ?
        ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ BUY ‡πÄ‡∏û‡∏£‡∏≤‡∏∞...
        
        ‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏≠‡∏∞‡πÑ‡∏£?
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á...
        """
        
        score = self.scorer.score_narrative(
            narrative, self.indicators, self.percentiles, self.ticker_data
        )
        
        expected = (
            score.dimension_scores['clarity'] * 0.20 +
            score.dimension_scores['coverage'] * 0.20 +
            score.dimension_scores['specificity'] * 0.20 +
            score.dimension_scores['alignment'] * 0.20 +
            score.dimension_scores['minimality'] * 0.10 +
            score.dimension_scores['consistency'] * 0.10
        )
        
        assert abs(score.overall_score - expected) < 0.01
    
    def test_format_score_report(self):
        """Test score report formatting"""
        narrative = """
        üìñ ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
        Uncertainty score 52/100
        
        üí° ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ
        Technical indicators...
        
        üéØ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ?
        ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ BUY
        
        ‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏≠‡∏∞‡πÑ‡∏£?
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á...
        """
        
        score = self.scorer.score_narrative(
            narrative, self.indicators, self.percentiles, self.ticker_data
        )
        
        report = self.scorer.format_score_report(score)
        
        assert "REASONING QUALITY SCORE REPORT" in report
        assert f"{score.overall_score:.1f}/100" in report
        assert "Dimension Breakdown:" in report


if __name__ == "__main__":
    pytest.main([__file__, "-v"])
