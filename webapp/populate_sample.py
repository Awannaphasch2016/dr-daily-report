#!/usr/bin/env python3
"""
Populate database with existing English audio report
"""

import os
import sys
import base64
from datetime import date
import requests

# Add parent directory to path
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

def save_existing_report():
    """Save the existing DBS19 English report to database"""
    
    # Check if English audio file exists
    audio_file = "../report_DBS19_english.mp3"
    if not os.path.exists(audio_file):
        print(f"‚ùå Audio file not found: {audio_file}")
        return False
    
    # Read audio file
    with open(audio_file, 'rb') as f:
        audio_bytes = f.read()
    
    audio_base64 = base64.b64encode(audio_bytes).decode('utf-8')
    
    # Sample report text (you can replace with actual report)
    report_text = """
üìñ **‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ**

‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó DBS Group Holdings Ltd ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏™‡∏π‡∏á ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡∏ó‡∏µ‡πà 51 ‡∏à‡∏≤‡∏Å 100 ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡πÑ‡∏ó‡∏•‡πå 66 ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå ‡πÅ‡∏™‡∏î‡∏á‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥

üí° **‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ**

‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ä‡πâ‡∏≤ ‡πÅ‡∏ï‡πà‡∏£‡∏≤‡∏Ñ‡∏≤ 22.06 ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ VWAP ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏£‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ä‡∏ô‡∏∞

üéØ **‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ?**

‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ BUY - ‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏î‡∏µ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
"""
    
    report_data = {
        'ticker': 'DBS19',
        'report_date': str(date.today()),
        'report_text': report_text,
        'audio_english_base64': audio_base64,
        'recommendation': 'BUY'
    }
    
    # Save to database
    api_url = "http://localhost:5000"
    try:
        response = requests.post(
            f"{api_url}/api/save_report",
            json=report_data,
            timeout=10
        )
        response.raise_for_status()
        print(f"‚úÖ Report saved successfully!")
        print(f"   View at: {api_url}/report/DBS19/{report_data['report_date']}")
        return True
    except requests.exceptions.ConnectionError:
        print(f"‚ùå Cannot connect to Flask app at {api_url}")
        print("   Start Flask app first: python webapp/app.py")
        return False
    except Exception as e:
        print(f"‚ùå Error: {str(e)}")
        return False


if __name__ == "__main__":
    save_existing_report()
