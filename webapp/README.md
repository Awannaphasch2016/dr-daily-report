# Flask Web Application for Ticker Reports

## Overview

A Flask web application that stores and displays ticker reports grouped by date with filtering capabilities.

## Features

- ? **Report Storage**: Stores ticker reports with date, text, charts, audio, and metadata
- ? **Grouped by Date**: Reports are automatically grouped by date for easy browsing
- ? **Ticker Filtering**: Filter reports by specific ticker symbol
- ? **Dual Audio Support**: Access both Thai and English audio versions
- ? **API Endpoints**: RESTful API for programmatic access
- ? **Modern UI**: Beautiful, responsive web interface

## Quick Start

### 1. Start the Flask App

```bash
cd webapp
python app.py
```

The app will be available at: **http://localhost:5000**

### 2. Generate and Save Reports

Generate a report and save it to the database:

```bash
doppler run --project rag-chatbot-worktree --config dev_personal -- python webapp/save_report_to_db.py DBS19
```

The agent will automatically save reports to the database when `WEBAPP_URL` environment variable is set.

### 3. View Reports

- Open browser: http://localhost:5000
- Filter by ticker using the dropdown
- Click on any report to view details and audio

## Routes

### Web Pages
- `/` - Main page showing reports grouped by date
- `/report/<ticker>/<date>` - View individual report details

### API Endpoints
- `GET /api/reports` - Get reports (supports `?ticker=` and `?date=` filters)
- `POST /api/save_report` - Save a new report
- `GET /audio/<ticker>/<date>/<language>` - Download audio file (thai/english)

## Database

The app uses SQLite database (`data/ticker_reports.db`) with automatic schema creation.

## Usage Example

1. **Start Flask app:**
   ```bash
   python webapp/app.py
   ```

2. **Generate and save report:**
   ```bash
   doppler run --project rag-chatbot-worktree --config dev_personal -- python webapp/save_report_to_db.py DBS19
   ```

3. **Or use API directly:**
   ```python
   import requests
   
   response = requests.post('http://localhost:5000/api/save_report', json={
       'ticker': 'DBS19',
       'report_date': '2024-11-02',
       'report_text': 'Your report text here...',
       'recommendation': 'BUY'
   })
   ```

4. **View in browser:** http://localhost:5000

## Integration

The agent automatically saves reports to the webapp database when `WEBAPP_URL` environment variable is set:

```bash
export WEBAPP_URL=http://localhost:5000
```

This enables automatic saving of reports as they're generated by the agent.
