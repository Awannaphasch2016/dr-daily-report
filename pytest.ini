[pytest]
# pytest configuration for dr-daily-report

# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# pytest-asyncio configuration
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Markers (Layer 1 - Primitives)
# See conftest.py for --tier option that composes these markers
markers =
    # === What the test needs (external dependencies) ===
    integration: External API calls (LLM, yfinance)
    smoke: Requires live API server running
    e2e: Requires Playwright browser
    # === Safety markers ===
    readonly: Tests safe to run against production (no writes, no side effects)
    # === Other markers ===
    legacy: LINE bot tests (skip in Telegram CI pipeline)
    slow: Takes >10 seconds
    ratelimited: Tests paused due to API rate limits (run with --run-ratelimited)

# Output options
# Default behavior: Tier 1 (unit + mocked tests)
# Excludes tests requiring external resources:
# - integration: External APIs (LLM, yfinance)
# - smoke: Live API server
# - e2e: Browser (Playwright)
# Note: ratelimited handled separately via --run-ratelimited flag
# Use --tier=N to override (see conftest.py for tier definitions)
addopts = -v --tb=short -m "not smoke and not e2e and not integration"

# Ignore patterns
norecursedirs = .git __pycache__ node_modules .aws-sam venv

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
